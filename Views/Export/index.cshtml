@model ContentfulApp.Models.ExportModel
<style>
    form div {
        margin-bottom: 25px;
    }

    input[type="text"] {
        width: 100%;
    }

    #exportButton {
        margin-top: 20px; 
        background-color:darkorange;
    }

    #loading {
        
    }


    #excelDownloadLink {
        text-decoration: underline;
    }

    #loading span {
        animation: loading 1s infinite;
    }

    #loading span:nth-child(2) {
        animation-delay: 0.2s;
    }

    #loading span:nth-child(3) {
        animation-delay: 0.4s;
    }

    @@keyframes loading {
        0% {
            opacity: 0;
        }

        50% {
            opacity: 1;
        }

        100% {
            opacity: 0;
        }
    }

    
</style>
@using (Html.BeginForm("Index", "Export", FormMethod.Post, new { id = "exportForm" } ))
{
    @Html.LabelFor(model => model.Environment)
    @Html.TextBoxFor(model => model.Environment)

    @Html.LabelFor(model => model.SpaceId)
    @Html.TextBoxFor(model => model.SpaceId)

    @Html.LabelFor(model => model.Locales)
    @Html.TextBoxFor(model => model.Locales)

    @Html.LabelFor(model => model.ContentTypes)
    @Html.TextBoxFor(model => model.ContentTypes)

    @Html.LabelFor(model => model.AccessToken)
    @Html.TextBoxFor(model => model.AccessToken)

    <input type="submit" value="Export" id="exportButton" />
}
<div id="loading" style="display:none;">Loading<span>.</span><span>.</span><span>.</span></div>


<div id="downloadLink" style="display:none;">
    <a id="excelDownloadLink" href="#">Kopiera denna länkadress och kopiera in i ny flik för att ladda ner excelfilen</a>
</div>

@section scripts {
    <script>

        $(function () {
            $('#exportForm').submit(function (event) {
                event.preventDefault(); // Hindra standardformuläret från att skickas

                // Visa "Loading..." texten
                $('#loading').show();

                $.ajax({
                    url: $(this).attr('action'), // Åtgärden i kontrollern för att hantera exporten
                    method: 'POST',
                    data: $(this).serialize(), // Serialize formulärets data
                    success: function (response) {
                        // Dölj "Loading..." texten
                        $('#loading').hide();

                        var downloadLink = $('#downloadLink');
                        downloadLink.show();
                        $('#excelDownloadLink').attr('href', response); // Lägg till nedladdningslänken
                    }
                });
            });
        });

    </script>
}
