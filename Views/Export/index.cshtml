@model ContentfulApp.Models.ExportModel
<style>
    form div {
        margin-bottom: 25px;
    }

    input[type="text"] {
        width: 100%;
    }

    #exportButton {
        margin-top: 20px; 
        background-color:darkorange;
    }

    label {
        font-weight: bold;
    }

    .dropdown {
        width: 250px; 
    }

    #excelDownloadLink {
        text-decoration: underline;
    }

    #loading span {
        animation: loading 1s infinite;
    }

    #loading span:nth-child(2) {
        animation-delay: 0.2s;
    }

    #loading span:nth-child(3) {
        animation-delay: 0.4s;
    }

    @@keyframes loading {
        0% {
            opacity: 0;
        }

        50% {
            opacity: 1;
        }

        100% {
            opacity: 0;
        }
    }

    
</style>
@using (Html.BeginForm("Index", "Export", FormMethod.Post, new { id = "exportForm" } ))
{
    @Html.LabelFor(model => model.Environment)
    
    @Html.DropDownListFor(model => model.Environment, new SelectList(new List<string>() { "Choose environment", "dev", "stage" }), new { @class = "form-control dropdown" })
    @Html.LabelFor(model => model.SpaceId)
    <small>ex: spz4r8efhveb</small>
    @Html.TextBoxFor(model => model.SpaceId)

    @Html.LabelFor(model => model.Locales)
    <small>ex: sv-SE, pl-PL</small>
    @Html.TextBoxFor(model => model.Locales)

    @Html.LabelFor(model => model.ContentTypesId)
    <small>ex: productListingPage, ad, brand </small>
    @Html.TextBoxFor(model => model.ContentTypesId)

    @Html.LabelFor(model => model.AccessToken)
    <small>your personal accesstoken from Contentful</small>
    @Html.TextBoxFor(model => model.AccessToken)
@*     @Html.TextBoxFor(model => model.AccessToken, new { autocomplete = "off" })
 *@
    <input type="submit" value="Export" id="exportButton" />
}
<div id="loading" style="display:none;">Loading<span>.</span><span>.</span><span>.</span></div>


<div id="downloadLink" style="display:none;">
    <a id="excelDownloadLink" href="#">Copy this link address and put it in a new tab to download the excel file</a>
</div>

@section scripts {
    <script>

        $(function () {
            $('#exportForm').submit(function (event) {
                event.preventDefault(); // Hindra standardformuläret från att skickas

                var isEmpty = false;
                $('input[type="text"], select').each(function () {
                    if ($(this).val() === '' || $(this).val() === 'Choose environment') {
                        isEmpty = true;
                        return false; // Break out of the loop
                    }
                });

                if (isEmpty) {
                    alert('All fields must be filled out.');
                    return false; // Prevent form submission
                }

                // Visa "Loading..." texten
                $('#loading').show();

                $.ajax({
                    url: $(this).attr('action'), // Åtgärden i kontrollern för att hantera exporten
                    method: 'POST',
                    data: $(this).serialize(), // Serialize formulärets data
                    success: function (response) {
                        // Dölj "Loading..." texten
                        $('#loading').hide();

                        var downloadLink = $('#downloadLink');
                        downloadLink.show();
                        $('#excelDownloadLink').attr('href', response); // Lägg till nedladdningslänken
                    }
                });
            });
        });

    </script>
}
